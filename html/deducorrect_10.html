<div class="container">

<table style="width: 100%;"><tr>
<td>correctRounding</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Correct records under linear restrictions for rounding errors</h2>

<h3>Description</h3>

<p>This algorithm tries to detect and repair records that violate linear (in)equality constraints by correcting possible rounding errors as described by Scholtus(2008).
Typically data is constrainted by <code class="reqn">Rx=a</code> and <code class="reqn">Qx \ge b</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">correctRounding(E, dat, ...)

## S3 method for class 'editset'
correctRounding(E, dat, ...)

## S3 method for class 'editmatrix'
correctRounding(E, dat, fixate = NULL, delta = 2,
  K = 10, round = TRUE, assumeUnimodularity = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p><code>editmatrix</code> or <code>editset</code> as generated by the <code>editrules</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p><code>data.frame</code> with the data to be corrected</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to other methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixate</code></td>
<td>
<p><code>character</code> with variable names that should not be changed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>tolerance on checking for rounding error</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>number of trials per record. See details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>round</code></td>
<td>
<p>should the solution be rounded, default TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assumeUnimodularity</code></td>
<td>
<p>If <code>FALSE</code>, a test is performed before corrections are computed (expensive).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The algorithm first finds violated constraints
<code class="reqn">|r'_{i}x-a_i| &gt; 0</code> , and selects edits that may be due to a rounding error <code class="reqn">0 &lt; |r'_{i}x-a_i| \leq \delta</code>.
The algorithm then makes a correction suggestion where the errors are attributed to randomly selected variables under the lineair equality constraints.
It checks if the suggested correction
does not violate the inequality matrix <code class="reqn">Q</code>. If it does, it will try to generate a different solution up till <code>K</code> times.
</p>


<h3>Value</h3>

<p>A <code>deducorrrect</code> object.
</p>


<h3>References</h3>

<p>Scholtus S (2008). Algorithms for correcting some obvious
inconsistencies and rounding errors in business survey data. Technical
Report 08015, Statistics Netherlands.
</p>


<h3>See Also</h3>

<p><code>deducorrect-object</code> <code>status</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
E &lt;- editmatrix(expression( 
    x1 + x2 == x3,
    x2 == x4,
    x5 + x6  + x7 == x8,
    x3 + x8 == x9,
    x9 - x10 == x11
    )
)

dat &lt;- data.frame( x1=12
                 , x2=4
                 , x3=15
                 , x4=4
                 , x5=3
                 , x6=1
                 , x7=8
                 , x8=11
                 , x9=27
                 , x10=41
                 , x11=-13
                 )

sol &lt;- correctRounding(E, dat)


# example with editset
for ( d in dir("../pkg/R/",full.names=TRUE) ) dmp &lt;- source(d)
E &lt;- editmatrix(expression(
    x + y == z,
    x &gt;= 0,
    y &gt;= 0,
    z &gt;= 0,
    if ( x &gt; 0 ) y &gt; 0
    ))
dat &lt;- data.frame(
    x = 1,
    y = 0,
    z = 1)
# solutions causing new violations of conditional rules are rejected 
sol &lt;- correctRounding(E,dat)

# An example with editset
E &lt;- editset(expression(
    x + y == z,
    x &gt;= 0,
    y &gt; 0,
    y &lt; 2,
    z &gt; 1,
    z &lt; 3,
    A %in% c('a','b'),
    B %in% c('c','d'),
    if ( A == 'a' ) B == 'b',
    if ( B == 'b' ) x &lt; 1
))
dat &lt;- data.frame(
    x = 0,
    y = 1,
    z = 2,
    A = 'a',
    B = 'b'
)

correctRounding(E,dat)    

</code></pre>


</div>