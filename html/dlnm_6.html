<div class="container">

<table style="width: 100%;"><tr>
<td>cr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Generate a Basis Matrix for Penalized Cubic Regression Splines </h2>

<h3>Description</h3>

<p>Generate the basis matrix for cubic regression splines with penalties on the second derivatives.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cr(x, df=10, knots=NULL, intercept=FALSE, fx= FALSE, S=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x </code></td>
<td>
<p> the predictor variable. Missing values are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df </code></td>
<td>
<p> degrees of freedom, basically the dimension of the basis matrix. If supplied in the absence of <code>knots</code>, it automatically selects <code>df+1-intercept</code> knots at equally-spaced quantiles of <code>x</code>. The minimum allowed is <code>df=3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots </code></td>
<td>
<p> breakpoints that define the spline. These are generally automatically selected, and not defined by the user. See Details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept </code></td>
<td>
<p> logical. If <code>TRUE</code>, an intercept is included in the basis matrix. See Details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fx </code></td>
<td>
<p> logical. If <code>TRUE</code>, it removes the penalization. See Details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S </code></td>
<td>
<p> penalty matrix, usually internally defined if <code>NULL</code> (default).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function has a usage similar to <code>bs</code> and <code>ns</code> in the <span class="pkg">splines</span> package. It produces spline transformations, however using a parameterization that represents the splines fit in terms of values at the knots. A penalty matrix is also defined. The same results are returned by the related <code>smooth constructor</code> in the package <span class="pkg">mgcv</span>, which is in fact called internally.
</p>
<p>The argument <code>knots</code> defines a vector of knots within the range of the predictor <code>x</code>, by default at equally-spaced quantiles. The penalization is defined on the second derivative of the function through a penalty matrix <code>S</code>.
</p>
<p>Similarly to <code>bs</code> and <code>ns</code>, setting <code>intercept=FALSE</code> (default) determines the exclusion of the first transformed variables, and the corresponding first row and column in <code>S</code>, thus avoiding identifiability issues during the model fitting. Note how the procedure of imposing identifiability constraints is different from that adopted by <code>smoothCon</code> in the package <span class="pkg">mgcv</span>, where a more complex reparameterization is produced. 
</p>


<h3>Value</h3>

<p>A matrix object of class <code>"cr"</code>. It contains the attributes <code>df</code>, <code>knots</code>, <code>intercept</code>, <code>fx</code>, and <code>S</code>, with values that can be different than the arguments provided due to internal reset.
</p>


<h3>Note</h3>

<p>The function is primarily added here to specify penalized DLMs and DLNMs using the so-called <em>external</em> method, <em>i.e.</em> by including the penalty matrix in the argument <code>paraPen</code> of the <code>gam</code> regression function in <span class="pkg">mgcv</span>  (see <code>cbPen</code>). However, this approach can be also used to fit standard uni-dimensional penalized cubic spline models as an alternative to the use of specific <code>smooth constructor</code>, as it takes advantage of the use of prediction and plotting functions in <span class="pkg">dlnm</span>.
</p>


<h3>Author(s)</h3>

<p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;, with internall calls to functions included in the package <span class="pkg">mgcv</span> by Simon N. Wood.</p>


<h3>References</h3>

<p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html">here</a>]
</p>
<p>Wood S. N. Generalized Additive Models: An Introduction with R. Chapman and Hall/CRC Press, 2006.
</p>


<h3>See Also</h3>

<p><code>ps</code> for P-splines. <code>bs</code> and <code>ns</code> for B-splines and natural cubic splines, respectively. <code>cbPen</code> for defining tensor-type bi-dimensional penalties in DLNMs. The related <code>smooth constructor</code> for cubic regression spline smooths in <span class="pkg">mgcv</span>. The <code>cb smooth constructor</code> for cross-basis penalized spline smooths.
</p>
<p>See <code>dlnm-package</code> for an introduction to the package and for links to package vignettes providing more detailed information.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># to be added soon
</code></pre>


</div>