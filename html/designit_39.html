<div class="container">

<table style="width: 100%;"><tr>
<td>optimize_design</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generic optimizer that can be customized by user provided functions for generating shuffles and progressing towards the minimal score</h2>

<h3>Description</h3>

<p>Generic optimizer that can be customized by user provided functions for generating shuffles and progressing towards the minimal score
</p>


<h3>Usage</h3>

<pre><code class="language-R">optimize_design(
  batch_container,
  samples = NULL,
  scoring = NULL,
  n_shuffle = NULL,
  shuffle_proposal_func = NULL,
  acceptance_func = accept_strict_improvement,
  aggregate_scores_func = identity,
  check_score_variance = TRUE,
  autoscale_scores = FALSE,
  autoscaling_permutations = 100,
  autoscale_useboxcox = TRUE,
  sample_attributes_fixed = FALSE,
  max_iter = 10000,
  min_delta = NA,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>batch_container</code></td>
<td>
<p>An instance of <code>BatchContainer</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samples</code></td>
<td>
<p>A <code>data.frame</code> with sample information.
Should be <code>NULL</code> if the <code>BatchContainer</code> already has samples in it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scoring</code></td>
<td>
<p>Scoring function or a named <code>list()</code> of scoring functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_shuffle</code></td>
<td>
<p>Vector of length 1 or larger, defining how many random sample
swaps should be performed in each iteration. If <code>length(n_shuffle)==1</code>,
this sets no limit to the number of iterations. Otherwise, the optimization
stops if the swapping protocol is exhausted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shuffle_proposal_func</code></td>
<td>
<p>A user defined function to propose the next shuffling of samples.
Takes priority over n_shuffle if both are provided. The function is called with
a BatchContainer <code>bc</code> and an integer parameter <code>iteration</code> for the current iteration number,
allowing very flexible shuffling strategies.
Mapper syntax is supported (see <code>purrr::as_mapper()</code>).
The returned function must either return a list with fields <code>src</code>and <code>dst</code> (for pairwise sample swapping)
or a numeric vector with a complete re-assigned sample order.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>acceptance_func</code></td>
<td>
<p>Alternative function to select a new score as the best one.
Defaults to strict improvement rule, i.e. all elements of a score have to be smaller or equal in order to accept the solution as better.
This may be replaced with an alternative acceptance function included in the package
(e.g. <code>mk_simanneal_acceptance_func()</code>) or a user provided function.
Mapper syntax is supported (see <code>purrr::as_mapper()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_scores_func</code></td>
<td>
<p>A function to aggregate multiple scores AFTER (potential) auto-scaling and BEFORE acceptance evaluation.
If a function is passed, (multi-dimensional) scores will be transformed (often to a single double value) before calling the acceptance function.
E.g., see <code>first_score_only()</code> or <code>worst_score()</code>.
Note that particular acceptance functions may require aggregation of a score to a single scalar in order to work, see for example those
generated by <code>mk_simanneal_acceptance_func()</code>.
Mapper syntax is supported (see <code>purrr::as_mapper()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_score_variance</code></td>
<td>
<p>Logical: if TRUE, scores will be checked for variability under sample permutation
and the optimization is not performed if at least one subscore appears to have a zero variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoscale_scores</code></td>
<td>
<p>Logical: if TRUE, perform a transformation on the fly to equally scale scores
to a standard normal. This makes scores more directly comparable and easier to aggregate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoscaling_permutations</code></td>
<td>
<p>How many random sample permutations should be done to estimate autoscaling parameters.
(Note: minimum will be 20, regardless of the specified value)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoscale_useboxcox</code></td>
<td>
<p>Logical; if TRUE, use a boxcox transformation for the autoscaling if possible at all.
Requires installation of the <code>bestNormalize</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_attributes_fixed</code></td>
<td>
<p>Logical; if TRUE, sample shuffle function may generate altered sample attributes at each iteration.
This affects estimation of score distributions. (Parameter only relevant if shuffle function does introduce attributes!)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>Stop optimization after a maximum number of iterations,
independent from other stopping criteria (user defined shuffle proposal or min_delta).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_delta</code></td>
<td>
<p>If not NA, optimization is stopped as soon as successive improvement (i.e. euclidean distance between score vectors
from current best and previously best solution) drops below min_delta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>If TRUE, suppress non-critical warnings or messages.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A trace object
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("invivo_study_samples")
bc &lt;- BatchContainer$new(
  dimensions = c("plate" = 2, "column" = 5, "row" = 6)
)
bc &lt;- optimize_design(bc, invivo_study_samples,
  scoring = osat_score_generator("plate", "Sex"),
  max_iter = 100
)
plot_plate(bc$get_samples(), .col = Sex)
</code></pre>


</div>