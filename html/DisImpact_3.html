<div class="container">

<table style="width: 100%;"><tr>
<td>di_calc_sql</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate SQL code that calculates disproportionate impact using multiple methods for a specified table.</h2>

<h3>Description</h3>

<p>Generate SQL code that calculates disproportionate impact via the percentage point gap (PPG), proportionality index, and 80% index methods for a specified table name, success variable, group variable, and cohort variable.  This is the workhorse function leveraged by the di_iterate_sql function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">di_calc_sql(
  db_table_name,
  success_var,
  group_var,
  cohort_var = "",
  weight_var = 1,
  ppg_reference_group = "overall",
  min_moe = 0.03,
  use_prop_in_moe = FALSE,
  prop_sub_0 = 0.5,
  prop_sub_1 = 0.5,
  di_prop_index_cutoff = 0.8,
  di_80_index_cutoff = 0.8,
  di_80_index_reference_group = "hpg",
  before_with_statement = "",
  after_with_statement = "",
  end_of_select_statement = "",
  where_statement = "",
  select_statement_add = ""
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>db_table_name</code></td>
<td>
<p>A character value specifying a database table name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>success_var</code></td>
<td>
<p>A character value specifying the success variable name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_var</code></td>
<td>
<p>A character value specifying the group (disaggregation) variable name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cohort_var</code></td>
<td>
<p>(Optional) A character value specifying the cohort variable.  If not specified, then a single cohort is assumed (defaults to an empty string, <code>''</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight_var</code></td>
<td>
<p>(Optional) A character variable specifying the weight variable if the input data set is summarized (i.e.,  the the success variables specified in <code>success_vars</code> contain count of successes).  Weight here corresponds to the denominator when calculating the success rate.  Defaults to a numeric <code>1</code> which treats each row as an individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppg_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using the percentage point gap method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_moe</code></td>
<td>
<p>The minimum margin of error to be used in the PPG calculation; see di_ppg.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_prop_in_moe</code></td>
<td>
<p>(<code>TRUE</code> or <code>FALSE</code>) Whether the estimated proportions should be used in the margin of error calculation by the PPG; see di_ppg.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop_sub_0</code></td>
<td>
<p>Default is 0.50; see di_ppg.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prop_sub_1</code></td>
<td>
<p>Default is 0.50; see di_ppg.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>di_prop_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the proportionality index; see di_prop_index; defaults to 0.80.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>di_80_index_cutoff</code></td>
<td>
<p>Threshold used for determining disproportionate impact using the 80% index; see di_80_index; defaults to 0.80.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>di_80_index_reference_group</code></td>
<td>
<p>Either <code>'overall'</code>, <code>'hpg'</code>, <code>'all but current'</code>, or a character value specifying a group from <code>group_var</code> to be used as the reference group for comparison using 80% index.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>before_with_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>after_with_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end_of_select_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>where_statement</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select_statement_add</code></td>
<td>
<p>Character value to be added to the SQL query to allow for modification.  Defaults to <code>''</code> (empty string).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A character value (SQL query) that could be executed on a database.
</p>


</div>